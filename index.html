<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Combined Currency and Capital Calculators</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        
        /* --- Styles from index.html --- */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* Use index.html body background as primary */
        }
        .card {
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .input-group input {
            padding-left: 3rem !important; 
        }
        .tab-button-inner {
            border-bottom-width: 4px; 
            margin-bottom: -2px; 
            z-index: 10;
            cursor: pointer;
            border-color: transparent; 
        }
        .tab-divider-inner {
            border-bottom: 2px solid #9ca3af; 
        }
        .tab-button-inner.hover-teal:hover {
            background-color: #04AA6D !important; 
            color: white !important; 
        }
        /* --- Custom style for the exchange calculator background inside the main div --- */
        .exchange-bg {
            background-color: white; /* Override the background gradient for the card area */
        }
        /* --- Styles for the new top-level tabs --- */
        .main-tab {
            cursor: pointer;
            transition: all 0.2s;
        }
        .main-tab.active {
            border-bottom: 4px solid #4f46e5; /* Indigo color from exchange.html */
            color: #4f46e5;
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'indigo-600': '#4f46e5',
                        'pink-500': '#ec4899',
                        'pink-600': '#db2777',
                    },
                },
            },
        }
    </script>
</head>
<body class="p-4 md:p-8 min-h-screen flex items-center justify-center">

    <div class="w-full max-w-4xl">
        <h1 class="text-4xl font-extrabold text-gray-800 mb-8 text-center">Combined Financial Calculators</h1>

        <div class="flex border-b border-gray-300 mb-8">
            <button id="main-tab-exchange" 
                    class="main-tab flex-1 py-3 text-center text-lg font-semibold text-gray-500 active" 
                    data-target="exchange">
                Currency Exchange Calculator
            </button>
            <button id="main-tab-mobile" 
                    class="main-tab flex-1 py-3 text-center text-lg font-semibold text-gray-500" 
                    data-target="mobile">
                Mobile Money and Capital Calculator
            </button>
        </div>
        
        <div id="main-calc-exchange" class="main-calc-section">
            <div class="max-w-lg w-full mx-auto exchange-bg rounded-2xl shadow-xl border border-gray-100 overflow-hidden">
                <div class="bg-gradient-to-r from-indigo-600 to-pink-500 p-6">
                    <h2 class="text-2xl font-bold text-white mb-2">Currency Exchange</h2>
                    <div class="flex border-b border-indigo-500/50">
                        <button id="EX_tab-forward" class="EX_tab-button flex-1 text-center py-2 text-sm font-semibold transition-colors duration-200" data-target="forward-calc">
                            ðŸ’° Euros to BDT
                        </button>
                        <button id="EX_tab-reverse" class="EX_tab-button flex-1 text-center py-2 text-sm font-semibold transition-colors duration-200" data-target="reverse-calc">
                            ðŸ”„ BDT to Euros
                        </button>
                    </div>
                </div>

                <div class="p-6 space-y-6">
                    <div>
                        <span class="block text-sm font-semibold text-gray-700 mb-2">Charge (â‚¬)</span>
                        <div class="space-y-3">
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="radio" name="EX_chargeOption" value="0" class="EX_charge-radio text-pink-500 focus:ring-pink-500" checked />
                                <span class="text-gray-800">No charge (â‚¬0)</span>
                            </label>
                            <div class="flex items-center gap-2">
                                <input type="radio" name="EX_chargeOption" value="custom" class="EX_charge-radio text-pink-500 focus:ring-pink-500" id="EX_chargeCustomRadio" />
                                <label for="EX_chargeCustom" class="text-gray-800">Custom (â‚¬)</label>
                                <input
                                    id="EX_chargeCustom"
                                    type="number"
                                    step="0.01"
                                    placeholder="Enter charge"
                                    class="EX_charge-input ml-2 w-32 rounded-lg border-gray-300 shadow-sm focus:border-pink-500 focus:ring-pink-500"
                                />
                            </div>
                        </div>
                    </div>

                    <div id="forward-calc" class="EX_calc-section space-y-6">
                        <p class="text-sm text-gray-500">Formula: (Euros - Charge) Ã— BDT Rate</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="EX_euros" class="block text-sm font-semibold text-gray-700">Euros (â‚¬)</label>
                                <input
                                    id="EX_euros"
                                    type="number"
                                    step="0.01"
                                    placeholder="Enter amount"
                                    class="EX_input-field mt-2 w-full rounded-lg border-gray-300 shadow-sm focus:border-pink-500 focus:ring-pink-500"
                                />
                            </div>
                            <div>
                                <label for="EX_bdtRate" class="block text-sm font-semibold text-gray-700">BDT Rate</label>
                                <input
                                    id="EX_bdtRate"
                                    type="number"
                                    step="0.0001"
                                    placeholder="Rate per â‚¬"
                                    class="EX_input-field mt-2 w-full rounded-lg border-gray-300 shadow-sm focus:border-pink-500 focus:ring-pink-500"
                                />
                            </div>
                        </div>
                        <div class="bg-indigo-50 border border-indigo-200 rounded-xl p-4 space-y-2">
                            <div class="flex justify-between text-sm text-gray-700">
                                <span>Selected charge</span>
                                <span id="EX_chargeDisplayForward" class="font-medium">â‚¬0.00</span>
                            </div>
                            <div class="flex justify-between text-sm text-gray-700">
                                <span>Net euros (Euros âˆ’ charge)</span>
                                <span id="EX_netEurosDisplayForward" class="font-medium">â‚¬0.00</span>
                            </div>
                            <div class="flex justify-between items-center mt-3">
                                <span class="text-sm font-semibold text-indigo-900">Output (BDT)</span>
                                <span id="EX_outputBDT" class="text-xl font-bold text-pink-600">0.00</span>
                            </div>
                        </div>
                    </div>

                    <div id="reverse-calc" class="EX_calc-section space-y-6 hidden">
                        <p class="text-sm text-gray-500">Formula: (BDT Ã· Rate in Euros) + Charge</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="EX_bdtAmount" class="block text-sm font-semibold text-gray-700">BDT Amount</label>
                                <input
                                    id="EX_bdtAmount"
                                    type="number"
                                    step="0.01"
                                    placeholder="Enter BDT"
                                    class="EX_input-field mt-2 w-full rounded-lg border-gray-300 shadow-sm focus:border-pink-500 focus:ring-pink-500"
                                />
                            </div>
                            <div>
                                <label for="EX_rateEuro" class="block text-sm font-semibold text-gray-700">Rate in Euros</label>
                                <input
                                    id="EX_rateEuro"
                                    type="number"
                                    step="0.0001"
                                    placeholder="Enter rate"
                                    class="EX_input-field mt-2 w-full rounded-lg border-gray-300 shadow-sm focus:border-pink-500 focus:ring-pink-500"
                                />
                            </div>
                        </div>
                        <div class="bg-indigo-50 border border-indigo-200 rounded-xl p-4 space-y-2">
                            <div class="flex justify-between text-sm text-gray-700">
                                <span>Selected charge</span>
                                <span id="EX_chargeDisplayReverse" class="font-medium">â‚¬0.00</span>
                            </div>
                            <div class="flex justify-between text-sm text-gray-700">
                                <span>BDT Ã· Rate in Euros</span>
                                <span id="EX_divisionDisplay" class="font-medium">0.00</span>
                            </div>
                            <div class="flex justify-between items-center mt-3">
                                <span class="text-sm font-semibold text-indigo-900">Final Result (â‚¬)</span>
                                <span id="EX_outputResult" class="text-xl font-bold text-pink-600">0.00</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex items-center gap-4 pt-4 border-t border-gray-100">
                        <button
                            id="EX_calcBtn"
                            class="flex-1 rounded-lg bg-gradient-to-r from-indigo-600 to-pink-500 px-4 py-2 text-white font-semibold shadow hover:opacity-90 transition"
                        >
                            Calculate
                        </button>
                        <button
                            id="EX_resetBtn"
                            class="flex-1 rounded-lg bg-gray-100 px-4 py-2 text-gray-800 font-semibold shadow hover:bg-gray-200 transition"
                        >
                            Reset
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div id="main-calc-mobile" class="main-calc-section hidden">
            <div class="w-full max-w-lg card bg-white rounded-xl p-6 md:p-10 mx-auto">
                <h2 class="text-3xl font-extrabold text-sky-700 mb-6 text-center">MOBILE MONEY AND CAPITAL CALCULATOR</h2>
                
                <div class="flex tab-divider-inner mb-8">
                    <button id="tab-euro-to-taka" 
                            class="tab-button-inner flex-1 py-3 text-center rounded-t-lg transition duration-200 ease-in-out" 
                            onclick="showSection('euroToTaka')">
                        Euro to Taka
                    </button>
                    <button id="tab-taka-to-euro" 
                            class="tab-button-inner flex-1 py-3 text-center rounded-t-lg transition duration-200 ease-in-out" 
                            onclick="showSection('takaToEuro')">
                        Taka to Euro
                    </button>
                    <button id="tab-capital-adjustment" 
                            class="tab-button-inner flex-1 py-3 text-center rounded-t-lg transition duration-200 ease-in-out" 
                            onclick="showSection('capitalAdjustment')">
                        Capital Adj.
                    </button>
                    </div>

                <div id="euroToTakaSection" class="calculator-section">
                    <h3 class="text-xl font-bold text-gray-700 mb-4">Euro to Taka Calculation</h3>
                    <div class="space-y-6">
                        <div class="input-group">
                            <label for="exchangeRate" class="block text-xl font-medium text-gray-700 mb-1 p-2 rounded-t-lg bg-sky-50">1. Exchange Rate (BDT per â‚¬)</label>
                            <div class="mt-1 relative rounded-md shadow-sm">
                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                    <span class="text-gray-500 sm:text-sm">BDT</span>
                                </div>
                                <input type="number" id="exchangeRate" min="0" step="0.01"
                                       class="block w-full rounded-lg border-2 border-sky-400 focus:border-sky-700 focus:ring-sky-700 p-3 sm:text-sm transition duration-150"
                                       placeholder="000">
                            </div>
                        </div>

                        <div class="input-group">
                            <label for="euroAmount" class="block text-xl font-medium text-gray-700 mb-1 p-2 rounded-t-lg bg-sky-50">2. Enter Amount in Euro (â‚¬)</label>
                            <div class="mt-1 relative rounded-md shadow-sm">
                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                    <span class="text-gray-500 sm:text-sm">â‚¬</span>
                                </div>
                                <input type="number" id="euroAmount" min="0" step="0.01"
                                       class="block w-full rounded-lg border-2 border-sky-400 focus:border-sky-700 focus:ring-sky-700 p-3 sm:text-sm transition duration-150"
                                       placeholder="000">
                            </div>
                        </div>
                    </div>

                    <div class="w-full mt-6">
                        <p class="text-sm font-medium text-gray-500 mb-2">Quick Select (â‚¬):</p>
                        <div class="flex flex-wrap gap-2">
                            <button onclick="setAmount(10, 'euro')" class="text-xs px-3 py-1 bg-sky-100 text-sky-700 rounded-lg hover:bg-sky-200 transition duration-150 border border-sky-300">â‚¬10</button>
                            <button onclick="setAmount(15, 'euro')" class="text-xs px-3 py-1 bg-sky-100 text-sky-700 rounded-lg hover:bg-sky-200 transition duration-150 border border-sky-300">â‚¬15</button>
                            <button onclick="setAmount(20, 'euro')" class="text-xs px-3 py-1 bg-sky-100 text-sky-700 rounded-lg hover:bg-sky-200 transition duration-150 border border-sky-300">â‚¬20</button>
                            <button onclick="setAmount(25, 'euro')" class="text-xs px-3 py-1 bg-sky-100 text-sky-700 rounded-lg hover:bg-sky-200 transition duration-150 border border-sky-300">â‚¬25</button>
                            <button onclick="setAmount(30, 'euro')" class="text-xs px-3 py-1 bg-sky-100 text-sky-700 rounded-lg hover:bg-sky-200 transition duration-150 border border-sky-300">â‚¬30</button>
                            <button onclick="setAmount(35, 'euro')" class="text-xs px-3 py-1 bg-sky-100 text-sky-700 rounded-lg hover:bg-sky-200 transition duration-150 border border-sky-300">â‚¬35</button>
                            <button onclick="setAmount(40, 'euro')" class="text-xs px-3 py-1 bg-sky-100 text-sky-700 rounded-lg hover:bg-sky-200 transition duration-150 border border-sky-300">â‚¬40</button>
                            <button onclick="setAmount(50, 'euro')" class="text-xs px-3 py-1 bg-sky-100 text-sky-700 rounded-lg hover:bg-sky-200 transition duration-150 border border-sky-300">â‚¬50</button>
                            <button onclick="setAmount(100, 'euro')" class="text-xs px-3 py-1 bg-sky-100 text-sky-700 rounded-lg hover:bg-sky-200 transition duration-150 border border-sky-300">â‚¬100</button>
                            <button onclick="setAmount(150, 'euro')" class="text-xs px-3 py-1 bg-sky-100 text-sky-700 rounded-lg hover:bg-sky-200 transition duration-150 border border-sky-300">â‚¬150</button>
                            <button onclick="setAmount(200, 'euro')" class="text-xs px-3 py-1 bg-sky-100 text-sky-700 rounded-lg hover:bg-sky-200 transition duration-150 border border-sky-300">â‚¬200</button>
                            <button onclick="setAmount(250, 'euro')" class="text-xs px-3 py-1 bg-sky-100 text-sky-700 rounded-lg hover:bg-sky-200 transition duration-150 border border-sky-300">â‚¬250</button>
                            <button onclick="setAmount(299, 'euro')" class="text-xs px-3 py-1 bg-sky-100 text-sky-700 rounded-lg hover:bg-sky-200 transition duration-150 border border-sky-300">â‚¬299</button>
                        </div>
                    </div>
                    <button onclick="clearInputsMobile()" class="w-full bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg transition duration-150 shadow-md mt-6">
                        Clear All Data
                    </button>

                    <div class="mt-8 pt-6 border-t border-sky-200 space-y-3">
                        <div class="flex justify-between items-center p-3 bg-sky-100 rounded-lg">
                            <span class="text-lg font-medium text-sky-800">Gross Value (Fee Tier Check)</span>
                            <span id="grossTakaOutput" class="text-lg font-semibold text-sky-900">0.00 BDT</span>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-red-100 rounded-lg">
                            <span class="text-lg font-medium text-red-800 font-semibold">Fixed Charge Deducted (EURO)</span>
                            <span id="feeAmountEuroOutput" class="text-lg font-extrabold text-red-900">0.00 â‚¬</span>
                        </div>
                        <div class="flex justify-between items-center p-4 bg-sky-100 border-l-4 border-sky-700 rounded-lg">
                            <span class="text-lg font-bold text-sky-800">Final BDT Output</span>
                            <span id="finalTakaOutput" class="text-2xl font-extrabold text-sky-900">0.00 BDT</span>
                        </div>

                        <div id="alternativeTakaOutputBox" class="flex justify-between items-center p-3 bg-yellow-100 rounded-lg hidden transition duration-300 ease-in-out">
                            <span id="alternativeTakaLabel" class="text-lg font-medium text-yellow-800">Alternative Output (Lower Fee Tier)</span>
                            <span id="alternativeTakaOutput" class="text-lg font-semibold text-yellow-900">0.00 BDT</span>
                        </div>
                        </div>
                </div>

                <div id="takaToEuroSection" class="calculator-section hidden">
                    <h3 class="text-xl font-bold text-gray-700 mb-4">Taka to Euro Calculation</h3>
                    <div class="space-y-6">
                         <div class="input-group">
                            <label for="bdtToEuroRate" class="block text-xl font-medium text-gray-700 mb-1 p-2 rounded-t-lg bg-emerald-50">1. Exchange Rate (BDT per â‚¬)</label>
                            <div class="mt-1 relative rounded-md shadow-sm">
                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                    <span class="text-gray-500 sm:text-sm">BDT</span>
                                </div>
                                <input type="number" id="bdtToEuroRate" min="0" step="0.01"
                                       class="block w-full rounded-lg border-2 border-emerald-400 focus:border-emerald-700 focus:ring-emerald-700 p-3 sm:text-sm transition duration-150"
                                       placeholder="000">
                            </div>
                        </div>

                        <div class="input-group">
                            <label for="bdtToEuroAmount" class="block text-xl font-medium text-gray-700 mb-1 p-2 rounded-t-lg bg-emerald-50">2. Enter Amount in Taka (BDT)</label>
                            <div class="mt-1 relative rounded-md shadow-sm">
                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                    <span class="text-gray-500 sm:text-sm">BDT</span>
                                </div>
                                <input type="number" id="bdtToEuroAmount" min="0" step="0.01"
                                       class="block w-full rounded-lg border-2 border-emerald-400 focus:border-emerald-700 focus:ring-emerald-700 p-3 sm:text-sm transition duration-150"
                                       placeholder="000">
                            </div>
                        </div>

                        <div class="w-full">
                            <p class="text-sm font-medium text-gray-500 mb-2">Quick Select (BDT):</p>
                            <div class="flex flex-wrap gap-1">
                                <button onclick="setAmount(1000, 'bdt')" class="text-xs px-2 py-1 bg-emerald-100 text-emerald-700 rounded-lg hover:bg-emerald-200 transition duration-150 border border-emerald-300">1000 BDT</button>
                                <button onclick="setAmount(5000, 'bdt')" class="text-xs px-2 py-1 bg-emerald-100 text-emerald-700 rounded-lg hover:bg-emerald-200 transition duration-150 border border-emerald-300">5000 BDT</button>
                                <button onclick="setAmount(10000, 'bdt')" class="text-xs px-2 py-1 bg-emerald-100 text-emerald-700 rounded-lg hover:bg-emerald-200 transition duration-150 border border-emerald-300">10000 BDT</button>
                                <button onclick="setAmount(15000, 'bdt')" class="text-xs px-2 py-1 bg-emerald-100 text-emerald-700 rounded-lg hover:bg-emerald-200 transition duration-150 border border-emerald-300">15000 BDT</button>
                                <button onclick="setAmount(20000, 'bdt')" class="text-xs px-2 py-1 bg-emerald-100 text-emerald-700 rounded-lg hover:bg-emerald-200 transition duration-150 border border-emerald-300">20000 BDT</button>
                                <button onclick="setAmount(50000, 'bdt')" class="text-xs px-2 py-1 bg-emerald-100 text-emerald-700 rounded-lg hover:bg-emerald-200 transition duration-150 border border-emerald-300">50000 BDT</button>
                            </div>
                        </div>
                        </div>
                    
                    <button onclick="clearInputsMobile()" class="w-full bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg transition duration-150 shadow-md mt-6">
                        Clear All Data
                    </button>

                    <div class="mt-8 pt-6 border-t border-emerald-200 space-y-3">
                        <div class="flex justify-between items-center p-3 bg-emerald-100 rounded-lg">
                            <span class="text-lg font-medium text-emerald-800">BDT Amount with 2% Charge</span>
                            <span id="bdtWithPercentOutput" class="text-lg font-semibold text-emerald-900">0.00 BDT</span>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-red-100 rounded-lg">
                            <span class="text-lg font-medium text-red-800 font-semibold">Fixed Charge Added (EURO)</span>
                            <span id="fixedEuroChargeBdtToEuroOutput" class="text-lg font-extrabold text-red-900">0.00 â‚¬</span>
                        </div>
                        <div class="flex justify-between items-center p-4 bg-emerald-100 border-l-4 border-emerald-700 rounded-lg">
                            <span class="text-lg font-bold text-emerald-800">Total Euro Required</span>
                            <span id="totalEurosOutput" class="text-2xl font-extrabold text-emerald-900">0.00 â‚¬</span>
                        </div>
                    </div>
                </div>
                
                <div id="capitalAdjustmentSection" class="calculator-section hidden">
                     <h3 class="text-xl font-bold text-gray-700 mb-4">Capital Adjustment Calculation</h3>
                    <p class="text-gray-500 mb-6 border-b pb-4">Calculates adjustments based on a starting Capital Amount in BDT (2.439% deduction, followed by 2.5% addition).</p>

                    <div class="space-y-6">
                         <div class="input-group">
                            <label for="capitalAmount" class="block text-xl font-medium text-gray-700 mb-1 p-2 rounded-t-lg bg-indigo-50">1. Enter Capital Amount (BDT)</label>
                            <div class="mt-1 relative rounded-md shadow-sm">
                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                    <span class="text-gray-500 sm:text-sm">BDT</span>
                                </div>
                                <input type="number" id="capitalAmount" min="0" step="0.01"
                                       class="block w-full rounded-lg border-2 border-indigo-400 focus:border-indigo-700 focus:ring-indigo-700 p-3 sm:text-sm transition duration-150"
                                       placeholder="000">
                            </div>
                        </div>
                    </div>
                    
                    <button onclick="clearInputsMobile()" class="w-full bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg transition duration-150 shadow-md mt-6">
                        Clear All Data
                    </button>

                    <div class="mt-8 pt-6 border-t border-indigo-200 space-y-3">
                        <div class="flex justify-between items-center p-3 bg-indigo-100 rounded-lg">
                            <span class="text-lg font-medium text-indigo-800">First Output (Capital - 2.439%)</span>
                            <span id="firstOutput" class="text-lg font-semibold text-indigo-900">0.00 BDT</span>
                        </div>
                        <div class="flex justify-between items-center p-4 bg-indigo-100 border-l-4 border-indigo-700 rounded-lg">
                            <span class="text-lg font-bold text-indigo-800">Final Input Value (First Output + 2.5%)</span>
                            <span id="finalOutput" class="text-2xl font-extrabold text-indigo-900">0.00 BDT</span>
                        </div>
                    </div>
                </div>
                <div class="mt-8 pt-4 border-t border-gray-200 text-center text-sm text-gray-500">
                    Developed by: Syed Nadir Ahmed
                    <div class="flex justify-center space-x-4 mt-1">
                        <a href="https://github.com/SyedNadirAhmed" target="_blank" class="text-blue-500 hover:text-blue-700 transition duration-150">GitHub</a>
                        <a href="https://bd.linkedin.com/in/syed-nadir-ahmed-20156213a" target="_blank" class="text-blue-500 hover:text-blue-700 transition duration-150">LinkedIn</a>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
        // --- MASTER TAB SWITCHING LOGIC ---
        const mainTabs = document.querySelectorAll('.main-tab');
        const mainSections = document.querySelectorAll('.main-calc-section');

        function switchMainCalculator(targetId) {
            mainSections.forEach(section => {
                section.classList.add('hidden');
            });
            document.getElementById('main-calc-' + targetId).classList.remove('hidden');

            mainTabs.forEach(tab => {
                tab.classList.remove('active');
            });
            document.getElementById('main-tab-' + targetId).classList.add('active');

            // Re-initialize the active sub-calculator on switch
            if (targetId === 'exchange') {
                switchCalculatorExchange('forward-calc');
            } else if (targetId === 'mobile') {
                showSection('euroToTaka');
            }
        }

        mainTabs.forEach(button => {
            button.addEventListener('click', () => switchMainCalculator(button.dataset.target));
        });

        // --- 1. CURRENCY EXCHANGE CALCULATOR SCRIPT (Namespaced with EX_) ---
        // --- Shared Elements ---
        const EX_tabButtons = document.querySelectorAll('.EX_tab-button');
        const EX_calcSections = document.querySelectorAll('.EX_calc-section');
        const EX_calcBtn = document.getElementById('EX_calcBtn');
        const EX_resetBtn = document.getElementById('EX_resetBtn');

        const EX_chargeRadios = document.querySelectorAll('input[name="EX_chargeOption"]');
        const EX_chargeCustomRadio = document.getElementById('EX_chargeCustomRadio');
        const EX_chargeCustomEl = document.getElementById('EX_chargeCustom');

        // --- Forward (Euros to BDT) Elements ---
        const EX_eurosEl = document.getElementById('EX_euros');
        const EX_bdtRateEl = document.getElementById('EX_bdtRate');
        const EX_chargeDisplayForward = document.getElementById('EX_chargeDisplayForward');
        const EX_netEurosDisplayForward = document.getElementById('EX_netEurosDisplayForward');
        const EX_outputBDT = document.getElementById('EX_outputBDT');

        // --- Reverse (BDT to Euros) Elements ---
        const EX_bdtAmountEl = document.getElementById('EX_bdtAmount');
        const EX_rateEuroEl = document.getElementById('EX_rateEuro');
        const EX_chargeDisplayReverse = document.getElementById('EX_chargeDisplayReverse');
        const EX_divisionDisplay = document.getElementById('EX_divisionDisplay');
        const EX_outputResult = document.getElementById('EX_outputResult');

        let EX_activeCalculator = 'forward-calc'; // State to track which calculator is active

        // --- Utility Functions ---

        function EX_toNum(v) {
            const n = parseFloat(v);
            return isNaN(n) ? 0 : n;
        }

        function EX_getSelectedCharge() {
            const selected = Array.from(EX_chargeRadios).find(r => r.checked)?.value;
            if (selected === 'custom') {
                return EX_toNum(EX_chargeCustomEl.value);
            }
            return EX_toNum(selected);
        }

        function EX_updateChargeDisplays(charge) {
            const chargeText = `â‚¬${charge.toFixed(2)}`;
            EX_chargeDisplayForward.textContent = chargeText;
            EX_chargeDisplayReverse.textContent = chargeText;
        }

        // --- Calculator Logic ---

        function EX_calculateForward() {
            const euros = EX_toNum(EX_eurosEl.value);
            const rate = EX_toNum(EX_bdtRateEl.value);
            const charge = EX_getSelectedCharge();

            const netEuros = Math.max(0, euros - charge);
            const bdt = netEuros * rate;

            EX_updateChargeDisplays(charge);
            EX_netEurosDisplayForward.textContent = `â‚¬${netEuros.toFixed(2)}`;
            EX_outputBDT.textContent = bdt.toFixed(2);
        }

        function EX_calculateReverse() {
            const bdt = EX_toNum(EX_bdtAmountEl.value); 
            const rate = EX_toNum(EX_rateEuroEl.value); 
            const charge = EX_getSelectedCharge();

            let division = 0;
            if (rate > 0) {
                division = bdt / rate;
            }

            const result = division + charge;

            EX_updateChargeDisplays(charge);
            EX_divisionDisplay.textContent = division.toFixed(2);
            EX_outputResult.textContent = result.toFixed(2);
        }

        function EX_calculate() {
            if (EX_activeCalculator === 'forward-calc') {
                EX_calculateForward();
            } else {
                EX_calculateReverse();
            }
        }

        // --- UI/Switching Logic ---

        function switchCalculatorExchange(targetId) {
            EX_activeCalculator = targetId;

            EX_calcSections.forEach(section => {
                if (section.id === targetId) {
                    section.classList.remove('hidden');
                } else {
                    section.classList.add('hidden');
                }
            });

            EX_tabButtons.forEach(button => {
                if (button.dataset.target === targetId) {
                    button.classList.add('bg-white/10', 'text-white', 'border-b-2', 'border-white');
                    button.classList.remove('text-indigo-100');
                } else {
                    button.classList.remove('bg-white/10', 'text-white', 'border-b-2', 'border-white');
                    button.classList.add('text-indigo-100');
                }
            });

            // Recalculate for the new active tab
            EX_calculate();
        }

        function EX_resetAll() {
            // Reset input fields
            document.querySelectorAll('.EX_input-field').forEach(el => el.value = '');
            EX_chargeCustomEl.value = '';

            // Reset charge option to 'No charge'
            document.querySelector('input[name="EX_chargeOption"][value="0"]').checked = true;

            // Reset result displays
            const zeroCharge = 'â‚¬0.00';
            const zeroValue = '0.00';
            
            EX_chargeDisplayForward.textContent = zeroCharge;
            EX_netEurosDisplayForward.textContent = zeroCharge;
            EX_outputBDT.textContent = zeroValue;

            EX_chargeDisplayReverse.textContent = zeroCharge;
            EX_divisionDisplay.textContent = zeroValue;
            EX_outputResult.textContent = zeroValue;

            // Recalculate 
            EX_calculate();
        }

        // --- Event Listeners for Exchange Calculator ---

        EX_tabButtons.forEach(button => {
            button.addEventListener('click', () => switchCalculatorExchange(button.dataset.target));
        });

        document.querySelectorAll('.EX_input-field').forEach(el => el.addEventListener('input', EX_calculate));
        EX_chargeRadios.forEach(r => r.addEventListener('change', EX_calculate));
        EX_chargeCustomEl.addEventListener('input', () => {
            if (!EX_chargeCustomRadio.checked) EX_chargeCustomRadio.checked = true;
            EX_calculate();
        });

        EX_calcBtn.addEventListener('click', EX_calculate);
        EX_resetBtn.addEventListener('click', EX_resetAll);


        // --- 2. MOBILE MONEY AND CAPITAL CALCULATOR SCRIPT (From index.html) ---
        
        const FEE_TIERS = [
            { start: 0, fee: 1.50, name: "1-1000 BDT" },
            { start: 1001, fee: 2.00, name: "1001-1500 BDT" },
            { start: 1501, fee: 2.50, name: "1501-3000 BDT" },
            { start: 3001, fee: 3.00, name: "3001-7000 BDT" },
            { start: 7001, fee: 4.00, name: "7001-9000 BDT" },
            { start: 9001, fee: 4.50, name: "9001-30000 BDT" },
            { start: 30001, fee: 5.50, name: "30001-50000 BDT" },
            { start: 50001, fee: 6.50, name: "50001-100000 BDT" },
            // Fee is 0 above 100000 BDT
        ];

        function getFixedEuroFeeByTaka(bdtValue) {
            if (isNaN(bdtValue) || bdtValue <= 0) return 0;
            
            let fee = 0;
            for (let i = FEE_TIERS.length - 1; i >= 0; i--) {
                if (bdtValue >= FEE_TIERS[i].start) {
                    fee = FEE_TIERS[i].fee;
                    break;
                }
            }
            return fee;
        }

        function getFeeDetails(bdtValue) {
            let currentFee = 0;
            let previousFee = null;
            let previousTierName = null;
            
            let currentIndex = -1;
            for (let i = FEE_TIERS.length - 1; i >= 0; i--) {
                if (bdtValue >= FEE_TIERS[i].start) {
                    currentIndex = i;
                    currentFee = FEE_TIERS[i].fee;
                    break;
                }
            }
            
            if (currentIndex > 0) {
                previousFee = FEE_TIERS[currentIndex - 1].fee;
                previousTierName = FEE_TIERS[currentIndex - 1].name;
            }
            
            return { currentFee, previousFee, previousTierName };
        }

        function calculateEuroToTaka() {
            const euroAmount = parseFloat(document.getElementById('euroAmount').value) || 0;
            const exchangeRate = parseFloat(document.getElementById('exchangeRate').value) || 0;

            const grossTakaOutput = document.getElementById('grossTakaOutput');
            const feeAmountEuroOutput = document.getElementById('feeAmountEuroOutput');
            const finalTakaOutput = document.getElementById('finalTakaOutput');
            const alternativeTakaOutputBox = document.getElementById('alternativeTakaOutputBox');
            const alternativeTakaOutput = document.getElementById('alternativeTakaOutput');
            const alternativeTakaLabel = document.getElementById('alternativeTakaLabel');

            const defaultOutput = '0.00';
            
            if (euroAmount <= 0 || exchangeRate <= 0) {
                grossTakaOutput.textContent = defaultOutput + ' BDT';
                feeAmountEuroOutput.textContent = defaultOutput + ' â‚¬';
                finalTakaOutput.textContent = defaultOutput + ' BDT';
                alternativeTakaOutputBox.classList.add('hidden');
                return;
            }

            const grossTaka = euroAmount * exchangeRate; 
            
            const feeDetails = getFeeDetails(grossTaka);
            const feeAmountEuro = feeDetails.currentFee;
            const netEuro = Math.max(0, euroAmount - feeAmountEuro);
            const finalTaka = netEuro * exchangeRate;

            let isAlternativeOutputShown = false;
            const previousFee = feeDetails.previousFee;

            if (previousFee !== null && feeAmountEuro > previousFee) {
                const alternativeNetEuro = Math.max(0, euroAmount - previousFee);
                const alternativeFinalTaka = alternativeNetEuro * exchangeRate;
                
                alternativeTakaOutputBox.classList.remove('hidden');
                alternativeTakaLabel.textContent = `Alternative Output (Fee: ${previousFee.toFixed(2)}â‚¬, Tier: ${feeDetails.previousTierName})`;
                alternativeTakaOutput.textContent = `${alternativeFinalTaka.toFixed(2)} BDT`;
                isAlternativeOutputShown = true;
            }
            
            if (!isAlternativeOutputShown) {
                alternativeTakaOutputBox.classList.add('hidden');
            }

            grossTakaOutput.textContent = `${grossTaka.toFixed(2)} BDT`;
            feeAmountEuroOutput.textContent = `${feeAmountEuro.toFixed(2)} â‚¬`;
            finalTakaOutput.textContent = `${finalTaka.toFixed(2)} BDT`;
        }

        function calculateTakaToEuro() {
            const bdtAmount = parseFloat(document.getElementById('bdtToEuroAmount').value) || 0;
            const currentRate = parseFloat(document.getElementById('bdtToEuroRate').value) || 0;

            const bdtWithPercentOutput = document.getElementById('bdtWithPercentOutput');
            const fixedEuroChargeBdtToEuroOutput = document.getElementById('fixedEuroChargeBdtToEuroOutput');
            const totalEurosOutput = document.getElementById('totalEurosOutput');

            const defaultOutput = '0.00';
            
            if (bdtAmount <= 0 || currentRate <= 0) {
                bdtWithPercentOutput.textContent = defaultOutput + ' BDT';
                fixedEuroChargeBdtToEuroOutput.textContent = defaultOutput + ' â‚¬';
                totalEurosOutput.textContent = defaultOutput + ' â‚¬';
                return;
            }

            const bdtWith2Percent = bdtAmount * 1.02;
            const fixedEuroFee = getFixedEuroFeeByTaka(bdtAmount);
            const eurosFromBdt = bdtWith2Percent / currentRate;
            const totalEuros = eurosFromBdt + fixedEuroFee;

            bdtWithPercentOutput.textContent = `${bdtWith2Percent.toFixed(2)} BDT`;
            fixedEuroChargeBdtToEuroOutput.textContent = `${fixedEuroFee.toFixed(2)} â‚¬`;
            totalEurosOutput.textContent = `${totalEuros.toFixed(2)} â‚¬`;
        }
        
        function formatBDT(amount) {
            return new Intl.NumberFormat('en-IN', {
                style: 'currency',
                currency: 'BDT',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(amount);
        }

        function calculateCapitalAdjustment() {
            const capitalAmountInput = document.getElementById('capitalAmount');
            const capitalAmount = parseFloat(capitalAmountInput.value) || 0;

            const firstOutputElement = document.getElementById('firstOutput');
            const finalOutputElement = document.getElementById('finalOutput');

            if (capitalAmount <= 0) {
                firstOutputElement.textContent = formatBDT(0);
                finalOutputElement.textContent = formatBDT(0);
                return;
            }

            // Calculation: C * (1 - 0.02439) => C * 0.97561
            const firstOutput = capitalAmount * 0.97561;

            firstOutputElement.textContent = formatBDT(firstOutput);

            // Calculation: O1 * (1 + 0.025) => O1 * 1.025
            const finalOutput = firstOutput * 1.025;
            
            finalOutputElement.textContent = formatBDT(finalOutput);
        }


        function setAmount(amount, currency) {
            if (currency === 'euro') {
                document.getElementById('euroAmount').value = amount;
                calculateEuroToTaka();
            } else if (currency === 'bdt') {
                document.getElementById('bdtToEuroAmount').value = amount;
                calculateTakaToEuro();
            }
        }

        function clearInputsMobile() {
            // Clear E/T inputs
            document.getElementById('euroAmount').value = '';
            document.getElementById('bdtToEuroAmount').value = '';
            document.getElementById('exchangeRate').value = ''; 
            document.getElementById('bdtToEuroRate').value = '';
            // Clear Capital input
            document.getElementById('capitalAmount').value = '';

            // Recalculate to reset outputs for *all* tabs
            calculateEuroToTaka();
            calculateTakaToEuro();
            calculateCapitalAdjustment();
            
            // Focus on the first input of the active section
            const activeSection = document.querySelector('#main-calc-mobile .calculator-section:not(.hidden)');
            if (activeSection) {
                const firstInput = activeSection.querySelector('input[type="number"]');
                if (firstInput) {
                    firstInput.focus();
                }
            }
        }

        const euroInput = document.getElementById('euroAmount');
        const rateInput = document.getElementById('exchangeRate');
        const bdtToEuroAmountInput = document.getElementById('bdtToEuroAmount');
        const bdtToEuroRateInput = document.getElementById('bdtToEuroRate');
        const capitalAmountInput = document.getElementById('capitalAmount');

        function showSection(sectionId) {
            // Hide/Show Section
            document.querySelectorAll('#main-calc-mobile .calculator-section').forEach(section => {
                section.classList.add('hidden');
            });
            document.getElementById(sectionId + 'Section').classList.remove('hidden');

            const allColorClasses = [
                'text-sky-700', 'border-sky-500', 'bg-sky-100', 'text-emerald-700', 'border-emerald-500', 'bg-emerald-100',
                'bg-sky-600', 'bg-sky-700', 'bg-sky-400', 'bg-sky-50', 
                'bg-emerald-600', 'bg-emerald-700', 'bg-emerald-400', 'bg-emerald-50', 
                'bg-indigo-600', 'bg-indigo-700', 'bg-indigo-400', 'bg-indigo-50',
                'bg-sky-300', 'bg-emerald-300', 'bg-indigo-300',
                'border-sky-400', 'focus:border-sky-700', 'focus:ring-sky-700',
                'border-emerald-400', 'focus:border-emerald-700', 'focus:ring-emerald-700',
                'border-indigo-400', 'focus:border-indigo-700', 'focus:ring-indigo-700',
                'border-sky-700', 'text-sky-800', 'text-sky-900',
                'border-emerald-700', 'text-emerald-800', 'text-emerald-900',
                'border-indigo-700', 'text-indigo-800', 'text-indigo-900',
                'text-white', 'font-bold', 'shadow-lg', 'text-gray-600', 'text-gray-800', 'border-transparent', 'shadow-md', 'hover-teal',
                'bg-red-100', 'text-red-800', 'text-red-900',
            ];
            
            const tabEuro = document.getElementById('tab-euro-to-taka');
            const tabTaka = document.getElementById('tab-taka-to-euro');
            const tabCapital = document.getElementById('tab-capital-adjustment');

            // 1. Reset all tabs
            tabEuro.classList.remove(...allColorClasses);
            tabEuro.classList.add('text-white', 'border-transparent', 'bg-sky-400', 'hover-teal'); 

            tabTaka.classList.remove(...allColorClasses);
            tabTaka.classList.add('text-white', 'border-transparent', 'bg-emerald-400', 'hover-teal'); 
            
            tabCapital.classList.remove(...allColorClasses);
            tabCapital.classList.add('text-white', 'border-transparent', 'bg-indigo-400', 'hover-teal'); 

            
            // 2. Update H2 color and clean up input borders
            const h2 = document.querySelector('#main-calc-mobile h2');
            h2.classList.remove(...allColorClasses); 
            
            const inputElements = [euroInput, rateInput, bdtToEuroAmountInput, bdtToEuroRateInput, capitalAmountInput];
            inputElements.forEach(input => input.classList.remove(...allColorClasses.filter(c => c.startsWith('border-') || c.startsWith('focus:'))));
            
            const finalTakaOutputBox = document.querySelector('#euroToTakaSection .border-l-4');
            const totalEurosOutputBox = document.querySelector('#takaToEuroSection .border-l-4');
            const finalCapitalOutputBox = document.querySelector('#capitalAdjustmentSection .border-l-4');

            const outputBoxes = [finalTakaOutputBox, totalEurosOutputBox, finalCapitalOutputBox];
            outputBoxes.forEach(box => {
                if (box) {
                    box.classList.remove(...allColorClasses);
                    const spans = box.querySelectorAll('span');
                    spans.forEach(span => span.classList.remove(...allColorClasses));
                }
            });

            // 3. Activate the selected tab
            const activeTab = document.getElementById('tab-' + sectionId);
            
            if (sectionId === 'euroToTaka') {
                activeTab.classList.remove('text-white', 'bg-sky-400');
                activeTab.classList.add('text-white', 'border-sky-700', 'bg-sky-700', 'font-bold', 'shadow-lg');
                h2.classList.add('text-sky-700', 'text-center');
                
                euroInput.classList.add('border-sky-400', 'focus:border-sky-700', 'focus:ring-sky-700');
                rateInput.classList.add('border-sky-400', 'focus:border-sky-700', 'focus:ring-sky-700');
                
                if(finalTakaOutputBox) {
                    finalTakaOutputBox.classList.add('bg-sky-100', 'border-l-4', 'border-sky-700');
                    finalTakaOutputBox.querySelector('span:first-child').classList.add('text-lg', 'font-bold', 'text-sky-800');
                    finalTakaOutputBox.querySelector('span:last-child').classList.add('text-2xl', 'font-extrabold', 'text-sky-900');
                }
                

                calculateEuroToTaka();

            } else if (sectionId === 'takaToEuro') {
                activeTab.classList.remove('text-white', 'bg-emerald-400');
                activeTab.classList.add('text-white', 'border-emerald-700', 'bg-emerald-700', 'font-bold', 'shadow-lg');
                h2.classList.add('text-emerald-700', 'text-center');
                
                bdtToEuroRateInput.classList.add('border-emerald-400', 'focus:border-emerald-700', 'focus:ring-emerald-700');
                bdtToEuroAmountInput.classList.add('border-emerald-400', 'focus:border-emerald-700', 'focus:ring-emerald-700');
                
                if(totalEurosOutputBox) {
                    totalEurosOutputBox.classList.add('bg-emerald-100', 'border-l-4', 'border-emerald-700');
                    totalEurosOutputBox.querySelector('span:first-child').classList.add('text-lg', 'font-bold', 'text-emerald-800');
                    totalEurosOutputBox.querySelector('span:last-child').classList.add('text-2xl', 'font-extrabold', 'text-emerald-900');
                }
                
                const bdtWithPercentOutputBox = document.querySelector('#takaToEuroSection > .mt-8 > div:nth-child(1)');
                if(bdtWithPercentOutputBox) {
                    bdtWithPercentOutputBox.classList.remove('bg-red-100');
                    bdtWithPercentOutputBox.classList.add('bg-emerald-100');
                    bdtWithPercentOutputBox.querySelector('span:first-child').classList.remove('text-red-800');
                    bdtWithPercentOutputBox.querySelector('span:first-child').classList.add('text-emerald-800');
                    bdtWithPercentOutputBox.querySelector('span:last-child').classList.remove('text-red-900');
                    bdtWithPercentOutputBox.querySelector('span:last-child').classList.add('text-emerald-900');
                }


                calculateTakaToEuro();
            } else if (sectionId === 'capitalAdjustment') {
                activeTab.classList.remove('text-white', 'bg-indigo-400');
                activeTab.classList.add('text-white', 'border-indigo-700', 'bg-indigo-700', 'font-bold', 'shadow-lg');
                h2.classList.add('text-indigo-700', 'text-center');

                capitalAmountInput.classList.add('border-indigo-400', 'focus:border-indigo-700', 'focus:ring-indigo-700');

                if(finalCapitalOutputBox) {
                    finalCapitalOutputBox.classList.add('bg-indigo-100', 'border-l-4', 'border-indigo-700');
                    finalCapitalOutputBox.querySelector('span:first-child').classList.add('text-lg', 'font-bold', 'text-indigo-800');
                    finalCapitalOutputBox.querySelector('span:last-child').classList.add('text-2xl', 'font-extrabold', 'text-indigo-900');
                }

                const firstOutputBox = document.querySelector('#capitalAdjustmentSection > .mt-8 > div:nth-child(1)');
                if(firstOutputBox) {
                    firstOutputBox.classList.remove('bg-gray-50');
                    firstOutputBox.classList.add('bg-indigo-100');
                    firstOutputBox.querySelector('span:first-child').classList.remove('text-gray-600');
                    firstOutputBox.querySelector('span:first-child').classList.add('text-indigo-800');
                    firstOutputBox.querySelector('span:last-child').classList.remove('text-green-700');
                    firstOutputBox.querySelector('span:last-child').classList.add('text-indigo-900');
                }

                calculateCapitalAdjustment();
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            // Mobile Calculator Listeners
            euroInput.addEventListener('input', calculateEuroToTaka);
            rateInput.addEventListener('input', calculateEuroToTaka);
            bdtToEuroAmountInput.addEventListener('input', calculateTakaToEuro);
            bdtToEuroRateInput.addEventListener('input', calculateTakaToEuro);
            capitalAmountInput.addEventListener('input', calculateCapitalAdjustment);

            // Initial setup - Start with the Currency Exchange Calculator active
            switchMainCalculator('exchange');
            switchCalculatorExchange('forward-calc');
        });
    </script>
</body>
</html>
